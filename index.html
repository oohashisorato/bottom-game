<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>2P Rhythm Game</title>
<style>
  body {
    margin:0;
    overflow:hidden;
    background:#222;
    position:relative;
  }
  #gameArea {
    position:relative;
    width:100vw;
    height:100vh;
    overflow:hidden;
  }
  /* レーン仕切り線 */
  #laneLine {
    position:absolute;
    left:50%;
    top:0;
    width:4px;
    height:100%;
    background:white;
    opacity:0.5;
    transform:translateX(-50%);
  }
  /* 判定ライン */
  #judgeLine {
    position:absolute;
    top:80%;
    left:0;
    width:100%;
    height:4px;
    background:yellow;
  }
  /* ノーツ */
  .note {
    position:absolute;
    width:16%;
    height:40px;
    border-radius:8px;
  }
  .leftNote { background:skyblue; left:17%; }
  .rightNote { background:pink; left:67%; }
  /* タップボタン */
  .hitBtn {
    position:absolute;
    width:20%;
    height:10%;
    border:none;
    border-radius:20px;
    color:white;
    font-size:20px;
  }
  #leftBtn { background:blue; left:5%; bottom:20%; }
  #rightBtn { background:deeppink; right:5%; bottom:20%; }
  /* HP表示 */
  #hp1, #hp2 {
    position:absolute;
    top:5%;
    font-size:20px;
    color:white;
  }
  #hp1 { left:10%; }
  #hp2 { right:10%; }
</style>
</head>

<body>
<div id="gameArea">
  <div id="laneLine"></div>
  <div id="judgeLine"></div>
  <div id="hp1">P1 HP: 100</div>
  <div id="hp2">P2 HP: 100</div>

  <button id="leftBtn" class="hitBtn">LEFT</button>
  <button id="rightBtn" class="hitBtn">RIGHT</button>
</div>

<script>
document.addEventListener("DOMContentLoaded", ()=>{

let hp1 = 100;
let hp2 = 100;

/* HP更新 */
function updateHP(){
  document.getElementById("hp1").innerText = `P1 HP: ${hp1}`;
  document.getElementById("hp2").innerText = `P2 HP: ${hp2}`;
  if(hp1 <=0){ alert("Player2 WIN!"); resetGame(); }
  if(hp2 <=0){ alert("Player1 WIN!"); resetGame(); }
}

/* ノーツ生成 */
function spawnNote(){
  const side = Math.random() < 0.5 ? "left" : "right";
  const note = document.createElement("div");
  note.classList.add("note");
  note.dataset.side = side;
  note.dataset.hit = "false";

  if(side === "left") note.classList.add("leftNote");
  else note.classList.add("rightNote");

  note.style.top = "-50px";
  document.getElementById("gameArea").appendChild(note);
}

/* ノーツ落下 */
function dropNotes(){
  const notes = document.querySelectorAll(".note");
  const speed = window.innerHeight * 0.005; // 画面サイズ比率で速度
  const judgeY = document.getElementById("judgeLine").offsetTop;
  notes.forEach(n=>{
    let y = parseFloat(n.style.top);
    n.style.top = (y + speed) + "px";

    if(y > window.innerHeight){
      n.remove();
    }
  });
}

/* タップ判定 */
function hit(side){
  const judgeY = document.getElementById("judgeLine").offsetTop;
  const range = window.innerHeight*0.05;  // 判定範囲

  const notes = Array.from(document.querySelectorAll(".note"))
    .filter(n => n.dataset.side === side && n.dataset.hit === "false");

  if(notes.length ===0) return;

  const note = notes[0];
  const noteY = parseFloat(note.style.top);

  if(Math.abs(noteY - judgeY) <= range){
    // 判定成功 → 相手HP減少
    if(side==="left") hp2 -= 5;
    else hp1 -= 5;
    updateHP();
  }

  note.dataset.hit = "true";
  note.remove();
}

/* ボタンイベントを pointerdown に変更 */
document.getElementById("leftBtn").addEventListener("pointerdown", ()=>hit("left"));
document.getElementById("rightBtn").addEventListener("pointerdown", ()=>hit("right"));

/* ゲームループ */
setInterval(spawnNote, 900);
setInterval(dropNotes, 16);

/* 再戦リセット */
function resetGame(){
  hp1 = hp2 = 100;
  updateHP();
  document.querySelectorAll(".note").forEach(n=>n.remove());
}

});
</script>
</body>
</html>
